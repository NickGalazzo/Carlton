@using Carlton.Base.Client.Components.Tree
@using Carlton.TestBed.TestBedNavTree
@using Carlton.TestBed.Client.Utils

<div class="carlton-test-bed-nav-tree">
    <div class="heading">
        <span>
            <img src="https://paradisebound.org/wp-content/uploads/2016/09/paradise-bound-ministries-mission-teams-homes-built-and-dedicated-house-icon.png" height="50" width="50" alt="Image result for house icon" />
            <span>Carlton Test Bed</span>
        </span>
    </div>
    <CarltonBaseTree Nodes="TreeItems"
                     ChildSelector="@(item => item.Children)"
                     @bind-SelectedNode="SelectedNode"
                     @bind-ExpandedNodes="ExpandedNodes"
                     HasChildNodes="@(item => item.Children?.Any() == true)"
                     Style="TreeStyle.DefaultTreeStyle">
        <TitleTemplate>@context.DisplayName</TitleTemplate>
    </CarltonBaseTree>
</div>


@code {
    [Parameter]
    public IEnumerable<TestBedNavTreeItem> TreeItems { get; set; }

    [Parameter]
    public EventCallback<TestBedNavTreeItem> SelectedItemChanged { get; set; }

    protected override void OnInitialized()
    {
        base.OnInitialized();
        SelectedNode = TreeItems.GetFirstSelectableTestState();
    }

    IList<TestBedNavTreeItem> ExpandedNodes = new List<TestBedNavTreeItem>();

    private TestBedNavTreeItem _selectedNode;
    private TestBedNavTreeItem SelectedNode
    {
        set
        {
            _selectedNode = value;
            SelectedItemChanged.InvokeAsync(value);
        }
        get
        {
            return _selectedNode;
        }
    }
}
